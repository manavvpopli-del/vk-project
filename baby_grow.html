<div class="family-app" style="color: #e2e8f0; font-family: 'Montserrat', sans-serif; max-width: 450px; margin: auto; padding: 20px;">
    
    <button id="pwa-btn" class="glass" style="display:none; width:100%; padding:15px; background:#f5b942; border:none; border-radius:15px; font-weight:800; margin-bottom:20px; cursor:pointer; color:#000;">
        <i class="fas fa-mobile-screen"></i> ANA EKRANA ∆èLAV∆è ET
    </button>

    <div id="setup-screen" class="glass" style="background:rgba(15,15,20,0.95); padding:30px; border-radius:30px; border:1px solid #c5a059; text-align:center;">
        <h2 style="font-family:'Playfair Display', serif; color:#f5b942;">Ail…ô Ocaƒüƒ±</h2>
        
        <div id="room-init">
            <p style="font-size:0.8rem; color:#888; margin-bottom:20px;">Otaq kodu t…ôyin edin v…ô t…ôr…ôfda≈üƒ±nƒ±zƒ± g√∂zl…ôyin.</p>
            <input type="text" id="room-code-input" placeholder="M…ôs: bizimlider" style="width:100%; padding:15px; background:#000; border:1px solid #333; border-radius:12px; color:#fff; margin-bottom:20px; text-align:center;">
            <button onclick="checkRoom()" class="btn-gold">Gƒ∞Rƒ∞≈û ET</button>
        </div>

        <div id="creation-panel" style="display:none; margin-top:20px; border-top:1px solid #222; padding-top:20px;">
            <p style="color:#2ed573; font-size:0.8rem; font-weight:700;"><i class="fas fa-check-double"></i> T∆èR∆èFDA≈û QO≈ûULDU!</p>
            <input type="text" id="baby-name-in" placeholder="K√∂rp…ônin Adƒ±" style="width:100%; padding:12px; background:#111; border:1px solid #333; border-radius:10px; color:#fff; margin:15px 0; text-align:center;">
            
            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <button class="choice-btn" id="btn-boy" onclick="setG('boy')">OƒûLAN</button>
                <button class="choice-btn" id="btn-girl" onclick="setG('girl')">QIZ</button>
            </div>
            
            <button onclick="confirmCreation()" class="btn-gold" style="background:#2ed573;">H∆èYATI BA≈ûLAT</button>
        </div>

        <div id="waiting-msg" style="display:none; margin-top:20px; color:#f5b942; font-size:0.8rem;">
            <i class="fas fa-spinner fa-spin"></i> T…ôr…ôfda≈ü g√∂zl…ônilir...
        </div>
    </div>

    <div id="game-screen" style="display:none;">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px; font-size:0.8rem;">
            <div style="color:#f5b942;"><i class="fas fa-users"></i> <span id="room-id-tag"></span></div>
            <div style="color:#2ed573;"><i class="fas fa-coins"></i> <span id="user-pts-live">0</span> PTS</div>
        </div>

        <div class="baby-cradle" style="height:320px; background:#000; border-radius:25px; position:relative; display:flex; align-items:center; justify-content:center; border:1px solid #222; overflow:hidden;">
            <img id="view-home" src="" style="position:absolute; inset:0; width:100%; height:100%; object-fit:cover; opacity:0.3; display:none;">
            <div id="baby-char" style="font-size: 7.5rem; z-index: 5; transition: 0.5s;">üë∂</div>
            <img id="view-cloth" src="" style="position:absolute; width:200px; z-index:6; display:none;">
        </div>

        <div style="text-align:center; margin-top:20px;">
            <h3 id="display-baby-name" style="font-family:'Playfair Display', serif; color:#f5b942; margin:0; font-size:1.8rem;">Ad</h3>
            <p id="alert-msg" style="color:#ff4757; font-size:0.7rem; font-weight:700; height:15px; margin-top:5px;"></p>
        </div>

        <div class="stats" style="margin-top:15px;">
            <div class="s-row">TOXLUQ: <span id="vh">0</span>% <div class="s-bar"><div id="bh" class="s-fill" style="background:#f5b942;"></div></div></div>
            <div class="s-row" style="margin-top:10px;">XO≈ûB∆èXTLƒ∞K: <span id="vl">0</span>% <div class="s-bar"><div id="bl" class="s-fill" style="background:#ff4757;"></div></div></div>
        </div>

        <div style="display:flex; gap:12px; margin-top:25px;">
            <button class="act-btn" onclick="care('hunger')"><i class="fas fa-apple-whole"></i> YEDƒ∞RT</button>
            <button class="act-btn" onclick="care('love')"><i class="fas fa-heart"></i> OYNA</button>
        </div>

        <div style="margin-top:30px; display:grid; grid-template-columns:1fr 1fr; gap:15px;">
            <div class="shop-card" onclick="shop('cloth', 400, 'https://cdn-icons-png.flaticon.com/512/963/963861.png')">
                <i class="fas fa-shirt" style="font-size:1.8rem; color:#f5b942;"></i><p>Paltar (400)</p>
            </div>
            <div class="shop-card" onclick="shop('home', 2000, 'https://cdn-icons-png.flaticon.com/512/619/619153.png')">
                <i class="fas fa-house-user" style="font-size:1.8rem; color:#f5b942;"></i><p>L√ºks Ev (2000)</p>
            </div>
        </div>
    </div>
</div>

<style>
    .glass { background:rgba(255,255,255,0.02); backdrop-filter:blur(10px); }
    .btn-gold { width:100%; padding:15px; background:#f5b942; border:none; border-radius:12px; font-weight:800; cursor:pointer; font-family:'Montserrat'; }
    .choice-btn { flex:1; padding:12px; background:#111; border:1px solid #333; color:#888; border-radius:10px; cursor:pointer; font-weight:700; }
    .choice-btn.active { border-color:#f5b942; color:#f5b942; background:rgba(245,185,66,0.1); }
    .s-row { font-size:0.7rem; font-weight:800; color:#c5a059; }
    .s-bar { width:100%; height:8px; background:#000; border-radius:5px; margin-top:5px; overflow:hidden; }
    .s-fill { height:100%; width:0%; transition:0.8s cubic-bezier(0.1, 0.8, 0.2, 1); }
    .act-btn { flex:1; padding:15px; background:#161822; border:1px solid #333; color:#fff; border-radius:15px; cursor:pointer; font-weight:700; }
    .shop-card { background:#161822; padding:20px; border-radius:20px; border:1px solid #222; text-align:center; cursor:pointer; transition:0.3s; }
    .shop-card:hover { border-color:#f5b942; transform:translateY(-5px); }
</style>

<script>
    // Firebase m√ºst…ôqil qo≈üulma
    if (!firebase.apps.length) {
        firebase.initializeApp({
            apiKey: "AIzaSyCM5WdZNSj9oFipNI-J3csHpOIvK8PjoLU",
            databaseURL: "https://sevgili-testi-default-rtdb.firebaseio.com"
        });
    }
    const familyDB = firebase.database();
    
    let activeRoom = null;
    let bG = "boy";
    let myUser = localStorage.getItem('active_user') || "Qonaq";
    let myLivePts = 0;

    function setG(v) { bG = v; document.getElementById('btn-boy').classList.toggle('active', v==='boy'); document.getElementById('btn-girl').classList.toggle('active', v==='girl'); }

    // Canlƒ± PTS izl…ôm…ô (Saytdakƒ± il…ô eyni olmasƒ± √º√ß√ºn)
    familyDB.ref('users/' + myUser + '/points').on('value', s => {
        myLivePts = s.val() || 0;
        if(document.getElementById('user-pts-live')) document.getElementById('user-pts-live').innerText = myLivePts;
    });

    async function checkRoom() {
        const code = document.getElementById('room-code-input').value.trim().toLowerCase();
        if(!code) return;
        activeRoom = code;

        const ref = familyDB.ref('families/' + activeRoom);
        
        // Otaƒüa oyun√ßu olaraq daxil ol
        await ref.child('players').child(myUser).set(true);

        ref.on('value', snap => {
            const data = snap.val();
            
            // ∆èg…ôr u≈üaq artƒ±q yaranƒ±bsa oyuna ke√ß
            if(data && data.babyName) {
                showGame(data);
            } else {
                // U≈üaq yoxdursa, ne√ß…ô n…ôf…ôr olduƒüunu yoxla
                const players = Object.keys(data.players || {});
                if(players.length >= 2) {
                    document.getElementById('room-init').style.display = 'none';
                    document.getElementById('creation-panel').style.display = 'block';
                    document.getElementById('waiting-msg').style.display = 'none';
                } else {
                    document.getElementById('waiting-msg').style.display = 'block';
                }
            }
        });
    }

    async function confirmCreation() {
        const name = document.getElementById('baby-name-in').value.trim();
        if(!name) return alert("Ad yazƒ±n!");
        
        await familyDB.ref('families/' + activeRoom).update({
            babyName: name, gender: bG,
            hunger: 100, love: 100, age: 0,
            cloth: "", home: ""
        });
    }

    function showGame(data) {
        document.getElementById('setup-screen').style.display = 'none';
        document.getElementById('game-screen').style.display = 'block';
        document.getElementById('room-id-tag').innerText = "KOD: " + activeRoom.toUpperCase();
        
        // UI Sinxronizasiyasƒ±
        document.getElementById('display-baby-name').innerText = data.babyName;
        document.getElementById('vh').innerText = Math.floor(data.hunger);
        document.getElementById('bh').style.width = data.hunger + "%";
        document.getElementById('vl').innerText = Math.floor(data.love);
        document.getElementById('bl').style.width = data.love + "%";

        const char = document.getElementById('baby-char');
        char.innerText = (data.gender === 'boy') ? "üë¶" : "üëß";
        if(data.hunger < 25) char.innerText = "üò≠";

        if(data.cloth) { document.getElementById('view-cloth').src = data.cloth; document.getElementById('view-cloth').style.display = 'block'; }
        if(data.home) { document.getElementById('view-home').src = data.home; document.getElementById('view-home').style.display = 'block'; }
        
        const alertMsg = document.getElementById('alert-msg');
        if(data.hunger < 30) alertMsg.innerText = "‚ö†Ô∏è K√ñRP∆è ACDIR!";
        else if(data.love < 30) alertMsg.innerText = "‚ö†Ô∏è K√ñRP∆è DARIXIR!";
        else alertMsg.innerText = "";
    }

    function care(t) {
        familyDB.ref('families/' + activeRoom).transaction(d => {
            if(d) d[t] = Math.min(100, (d[t] || 0) + 10);
            return d;
        });
    }

    async function shop(type, cost, url) {
        if(myLivePts < cost) return alert("PTS kifay…ôt deyil!");
        
        // Real balansdan √ßƒ±xƒ±≈ü
        await familyDB.ref('users/' + myUser + '/points').set(myLivePts - cost);

        let up = {};
        if(type === 'cloth') up.cloth = url;
        if(type === 'home') up.home = url;
        await familyDB.ref('families/' + activeRoom).update(up);
        alert("Satƒ±n alƒ±ndƒ±!");
    }
</script>