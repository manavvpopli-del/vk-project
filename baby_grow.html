<div class="life-app-wrapper" style="color: white; font-family: 'Montserrat', sans-serif; text-align: center; max-width: 500px; margin: auto;">
    
    <div id="pwa-install-btn" style="display:none; background: linear-gradient(45deg, #f5b942, #c5a059); color: black; padding: 15px; border-radius: 20px; margin-bottom: 25px; cursor: pointer; font-weight: 700; box-shadow: 0 10px 20px rgba(245, 185, 66, 0.2);" onclick="triggerInstall()">
        <i class="fas fa-mobile-screen-button"></i> BU MODULU TELEFONA ∆èLAV∆è ET
    </div>

    <div id="life-header" style="margin-bottom: 30px;">
        <h2 style="font-family: 'Cinzel Decorative'; color: #f5b942; letter-spacing: 2px;">CELESTIAL LIFE</h2>
        <p style="font-size: 0.8rem; color: #888;">ƒ∞ki ruh, bir yeni h…ôyat.</p>
    </div>

    <div id="life-join" class="glass-card" style="background: rgba(255,255,255,0.02); padding: 30px; border-radius: 25px; border: 1px solid rgba(245, 185, 66, 0.1);">
        <p style="margin-bottom: 15px; font-size: 0.9rem;">Ail…ô Kodunuzu daxil edin:</p>
        <input type="text" id="family-id" placeholder="M…ôs: elvin_ayten_2026" style="width: 100%; padding: 15px; background: #000; border: 1px solid #333; border-radius: 12px; color: #fff; text-align: center; margin-bottom: 20px; outline: none;">
        <button class="btn-gold" onclick="connectLife()" style="width: 100%; padding: 15px; background: #f5b942; border: none; border-radius: 12px; font-weight: 700; cursor: pointer; letter-spacing: 1px;">BAƒûLANTI QUR</button>
    </div>

    <div id="life-display" style="display:none; animation: fadeIn 1s ease;">
        <div id="visual-container" style="height: 200px; display: flex; align-items: center; justify-content: center; position: relative;">
            <div id="entity-visual" style="font-size: 7rem; filter: drop-shadow(0 0 20px rgba(245, 185, 66, 0.3)); transition: 0.5s transform;">üë∂</div>
        </div>
        
        <h3 id="entity-name" style="color: #f5b942; font-family: 'Cinzel Decorative';">K√∂rp…ô</h3>
        
        <div class="stats-grid" style="margin: 30px 0; display: grid; gap: 20px;">
            <div class="stat-item">
                <div style="display:flex; justify-content:space-between; font-size: 0.7rem; margin-bottom: 5px;"><span>ACLIQ</span> <span id="val-hunger">50%</span></div>
                <div class="bar-bg"><div id="bar-hunger" class="bar-fill" style="background: #f5b942;"></div></div>
            </div>
            <div class="stat-item">
                <div style="display:flex; justify-content:space-between; font-size: 0.7rem; margin-bottom: 5px;"><span>SEVGƒ∞</span> <span id="val-love">50%</span></div>
                <div class="bar-bg"><div id="bar-love" class="bar-fill" style="background: #ff4757;"></div></div>
            </div>
        </div>

        <div style="display: flex; gap: 10px;">
            <button class="act-btn" onclick="care('hunger')"><i class="fas fa-cookie-bite"></i> Qƒ∞DALANDIR</button>
            <button class="act-btn" onclick="care('love')"><i class="fas fa-heart"></i> SEVGƒ∞ VER</button>
        </div>
    </div>
</div>

<style>
    .glass-card { backdrop-filter: blur(10px); }
    .bar-bg { width: 100%; height: 6px; background: #111; border-radius: 10px; overflow: hidden; }
    .bar-fill { height: 100%; width: 50%; transition: 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    .act-btn { flex: 1; padding: 15px; background: rgba(255,255,255,0.03); border: 1px solid #333; color: white; border-radius: 15px; cursor: pointer; font-size: 0.7rem; font-weight: 700; transition: 0.3s; }
    .act-btn:hover { border-color: #f5b942; background: rgba(245, 185, 66, 0.05); }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
</style>

<script>
    let famRef = null;
    let installPrompt = null;

    // Detect PWA Installation capability
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        installPrompt = e;
        document.getElementById('pwa-install-btn').style.display = 'block';
    });

    function triggerInstall() {
        if (installPrompt) {
            installPrompt.prompt();
            installPrompt.userChoice.then((choice) => {
                if (choice.outcome === 'accepted') document.getElementById('pwa-install-btn').style.display = 'none';
            });
        } else {
            // iOS Logic
            alert("iOS √º√ß√ºn: Safari menyusunda 'Add to Home Screen' (Ana ekrana …ôlav…ô et) d√ºym…ôsini se√ßin.");
        }
    }

    function connectLife() {
        const id = document.getElementById('family-id').value.trim();
        if(!id) return alert("Kod daxil edin!");
        
        document.getElementById('life-join').style.display = 'none';
        document.getElementById('life-display').style.display = 'block';

        // window.db is the global Firebase ref from index.html
        famRef = window.db.ref('games/celestial_life/' + id);
        
        famRef.on('value', (snap) => {
            const data = snap.val() || { hunger: 50, love: 50, age: 0 };
            syncUI(data);
        });
    }

    function syncUI(data) {
        document.getElementById('val-hunger').innerText = data.hunger + "%";
        document.getElementById('bar-hunger').style.width = data.hunger + "%";
        document.getElementById('val-love').innerText = data.love + "%";
        document.getElementById('bar-love').style.width = data.love + "%";
        
        const visual = document.getElementById('entity-visual');
        if(data.hunger < 20) visual.innerText = "üò≠";
        else if(data.age > 100) { visual.innerText = "üßí"; document.getElementById('entity-name').innerText = "B√∂y√ºm√º≈ü U≈üaq"; }
        else visual.innerText = "üë∂";
    }

    function care(type) {
        if(!famRef) return;
        famRef.transaction(current => {
            if(!current) current = { hunger: 50, love: 50, age: 0 };
            current[type] = Math.min(100, current[type] + 15);
            current.age = (current.age || 0) + 1;
            return current;
        });
        // Feedback animation
        const v = document.getElementById('entity-visual');
        v.style.transform = "scale(1.2)";
        setTimeout(() => v.style.transform = "scale(1)", 200);
    }
</script>