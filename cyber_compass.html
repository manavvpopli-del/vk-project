<div class="tool-container" style="color: white; text-align: center;">
    <h3 style="color: #25d366;"><i class="fas fa-compass"></i> CYBER COMPASS</h3>
    <p>Otaq kodu ilə gir və barmağını ekranda gəzdir. Onu tap!</p>
    <input type="text" id="comp-room" placeholder="Otaq Kodu">
    <button class="btn" onclick="startCompass()">BAŞLA</button>

    <div id="compass-field" style="display:none; width: 100%; height: 300px; background: #050505; margin-top: 20px; position: relative; overflow: hidden; border-radius: 20px; cursor: crosshair;">
        <div id="feedback" style="position: absolute; inset:0; pointer-events: none; transition: 0.3s;"></div>
    </div>
</div>

<script>
    function startCompass() {
        const room = document.getElementById('comp-room').value;
        const field = document.getElementById('compass-field');
        field.style.display = 'block';
        
        field.onmousemove = (e) => {
            const rect = field.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            window.db.ref('games/compass/'+room+'/'+window.loginName).set({x, y});
        };

        window.db.ref('games/compass/'+room).on('value', s => {
            const data = s.val();
            const players = Object.keys(data || {});
            if(players.length === 2) {
                const p1 = data[players[0]]; const p2 = data[players[1]];
                const dist = Math.sqrt(Math.pow(p1.x-p2.x, 2) + Math.pow(p1.y-p2.y, 2));
                const feed = document.getElementById('feedback');
                if(dist < 30) {
                    feed.style.background = "rgba(37, 211, 102, 0.4)";
                    if(dist < 10) feed.style.background = "rgba(37, 211, 102, 0.8)";
                } else {
                    feed.style.background = "transparent";
                }
            }
        });
    }
</script>