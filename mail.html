<div class="module-card" style="background: rgba(17, 20, 29, 0.95); padding: 30px; border-radius: 20px; border: 1px solid var(--accent); color: white;">
    <h2 style="color: var(--accent); margin: 0 0 15px 0;"><i class="fas fa-envelope"></i> Anonim Mail (Mail.tm)</h2>
    
    <div id="m-box" style="padding: 20px; background: rgba(0,0,0,0.5); border: 1px dashed var(--accent); border-radius: 12px; text-align: center; margin-bottom: 20px; font-family: monospace; color: var(--accent);">
        Hazırlanır...
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
        <button class="btn" id="m-gen" onclick="createNewMailModule()">YENİ MAİL</button>
        <button class="btn" id="m-refresh" style="background: #1e293b; color: white; display: none;" onclick="checkInboxModule()">YOXLA</button>
    </div>

    <div id="m-list" style="margin-top: 20px; max-height: 200px; overflow-y: auto;"></div>
</div>

<script>
    // Tokeni window səviyyəsində saxlayırıq ki, itməsin
    window.modToken = "";

    async function createNewMailModule() {
        const box = document.getElementById('m-box');
        box.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Yaradılır...';
        
        try {
            const domains = await (await fetch('https://api.mail.tm/domains')).json();
            const domain = domains['hydra:member'][0].domain;
            const email = `elite${Math.floor(Math.random()*999999)}@${domain}`;
            const pass = "password123";

            await fetch('https://api.mail.tm/accounts', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ address: email, password: pass })
            });

            const tok = await (await fetch('https://api.mail.tm/token', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ address: email, password: pass })
            })).json();

            window.modToken = tok.token;
            box.innerText = email;
            document.getElementById('m-refresh').style.display = 'block';
            document.getElementById('m-list').innerHTML = '<div style="text-align:center; color:#555;">Inbox aktivdir.</div>';
        } catch (e) {
            box.innerText = "API Xətası! Serverə qoşulmadı.";
        }
    }

    async function checkInboxModule() {
        if (!window.modToken) return;
        const list = document.getElementById('m-list');
        list.innerHTML = "Yoxlanılır...";
        
        try {
            const res = await fetch('https://api.mail.tm/messages', {
                headers: { 'Authorization': `Bearer ${window.modToken}` }
            });
            const data = await res.json();
            const msgs = data['hydra:member'];
            
            list.innerHTML = msgs.length === 0 ? "Mesaj yoxdur." : "";
            msgs.forEach(m => {
                list.innerHTML += `<div style="background:#111; padding:10px; border-radius:8px; margin-bottom:5px; border:1px solid #333;"><b>${m.subject}</b><br><small>${m.from.address}</small></div>`;
            });
        } catch (e) { list.innerHTML = "Xəta."; }
    }
</script>