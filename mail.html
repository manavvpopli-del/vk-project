<div style="background: rgba(17, 20, 29, 0.95); padding: 30px; border-radius: 25px; border: 1px solid var(--accent); animation: fadeIn 0.4s ease;">
    <h2 style="color: var(--accent); margin:0; font-size: 1.5rem;"><i class="fas fa-envelope-open-text"></i> Anonim Mail Pro</h2>
    <p style="font-size: 0.8rem; color: #888; margin-top: 5px;">Mail.tm serverlərinə birbaşa bağlantı.</p>

    <div id="m-box" style="padding: 20px; background: rgba(0,0,0,0.5); border: 1px dashed var(--accent); margin: 20px 0; text-align: center; font-family: monospace; color: var(--accent); font-size: 1rem; word-break: break-all;">
        Gözlənilir...
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
        <button class="btn" id="m-create-btn" onclick="getNewMail()">YENİ MAİL</button>
        <button class="btn" id="m-refresh-btn" style="background: #1e293b; color: white; display: none;" onclick="checkInbox()">YOXLA</button>
    </div>

    <div id="m-list" style="margin-top: 20px; font-size: 0.85rem; color: #ccc;"></div>
</div>

<script>
    // Qlobal tokeni yoxlayırıq və ya yaradırıq
    window.m_token = window.m_token || "";

    async function getNewMail() {
        const box = document.getElementById('m-box');
        const btn = document.getElementById('m-create-btn');
        btn.disabled = true;
        box.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Yaradılır...';

        try {
            // 1. Domain al
            const d_res = await fetch('https://api.mail.tm/domains');
            const d_data = await d_res.json();
            const domain = d_data['hydra:member'][0].domain;

            // 2. User/Pass
            const user = `elite${Math.floor(Math.random()*999999)}@${domain}`;
            const pass = "password123";

            // 3. Hesab yarat
            await fetch('https://api.mail.tm/accounts', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ address: user, password: pass })
            });

            // 4. Token al
            const t_res = await fetch('https://api.mail.tm/token', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ address: user, password: pass })
            });
            const t_data = await t_res.json();
            window.m_token = t_data.token;

            box.innerText = user;
            document.getElementById('m-refresh-btn').style.display = 'block';
            btn.disabled = false;
        } catch (e) {
            box.innerHTML = '<span style="color:var(--red)">XƏTA: API bloklanıb və ya internet yoxdur</span>';
            btn.disabled = false;
        }
    }

    async function checkInbox() {
        const list = document.getElementById('m-list');
        list.innerHTML = "Yoxlanılır...";
        try {
            const res = await fetch('https://api.mail.tm/messages', {
                headers: { 'Authorization': `Bearer ${window.m_token}` }
            });
            const data = await res.json();
            const msgs = data['hydra:member'];
            list.innerHTML = msgs.length === 0 ? "Mesaj yoxdur." : "";
            msgs.forEach(m => {
                list.innerHTML += `<div style="background:#111; padding:10px; border-radius:8px; border:1px solid #333; margin-bottom:5px;"><b>${m.subject}</b><br><small>${m.from.address}</small></div>`;
            });
        } catch (e) { list.innerHTML = "Xəta baş verdi."; }
    }
</script>