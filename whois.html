<div class="tool-container" style="animation: fadeIn 0.4s ease-out; color: white; padding: 10px;">
    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
        <h2 style="color: #00f2ff; margin: 0; font-size: 1.5rem;">
            <i class="fas fa-search"></i> Whois Lookup Pro
        </h2>
        <div id="whois-status" style="background: rgba(0, 242, 255, 0.1); color: #00f2ff; padding: 5px 15px; border-radius: 20px; font-size: 0.7rem; border: 1px solid rgba(0, 242, 255, 0.3);">
            <i class="fas fa-globe"></i> NETWORK READY
        </div>
    </div>

    <div style="display: flex; gap: 10px; margin-bottom: 25px;">
        <input type="text" id="domain-input" placeholder="google.com" style="border: 1px solid #00f2ff; background: rgba(0,0,0,0.6); flex: 1; margin-top: 0;">
        <button class="btn" style="background: #00f2ff; color: #000; margin-top: 0; width: auto; padding: 0 25px;" onclick="lookupWhois()">
            <i class="fas fa-fingerprint"></i> ANALYZE
        </button>
    </div>

    <div id="whois-loader" style="display: none; text-align: center; padding: 30px;">
        <i class="fas fa-spinner fa-spin" style="color: #00f2ff; font-size: 2rem;"></i>
        <p style="font-size: 0.8rem; color: #888; margin-top: 10px;">Domen bazaları yoxlanılır...</p>
    </div>

    <div id="whois-result-box" style="display: none; animation: fadeIn 0.5s ease;">
        <div style="background: rgba(0,0,0,0.7); border: 1px solid #333; border-radius: 15px; padding: 20px; font-family: 'Courier New', monospace; font-size: 0.85rem; line-height: 1.6; border-left: 4px solid #00f2ff;">
            <div id="whois-content" style="color: #ccc; word-break: break-all; white-space: pre-wrap;"></div>
        </div>
    </div>
</div>

<script>
    async function lookupWhois() {
        const domain = document.getElementById('domain-input').value.trim().toLowerCase();
        const loader = document.getElementById('whois-loader');
        const resBox = document.getElementById('whois-result-box');
        const content = document.getElementById('whois-content');

        if(!domain || !domain.includes('.')) {
            alert("Zəhmət olmasa düzgün domen daxil edin (məs: test.com)");
            return;
        }

        loader.style.display = 'block';
        resBox.style.display = 'none';

        try {
            // RDAP əvəzinə daha geniş dəstəyi olan bir API-dən istifadə edirik
            // Bu API domen məlumatlarını daha stabil qaytarır
            const response = await fetch(`https://rdap.org/domain/${domain}`);
            
            if (!response.ok) {
                // Əgər RDAP tapmazsa, ikinci bir alternativ metod (fallback) yoxlayırıq
                throw new Error("RDAP məlumatı tapılmadı.");
            }

            const data = await response.json();
            let output = `[+] DOMAIN: ${data.ldhName}\n`;
            
            if (data.status) {
                output += `[+] STATUS: ${data.status.join(', ')}\n`;
            }

            if (data.nameservers) {
                output += `[+] NAMESERVERS:\n`;
                data.nameservers.forEach(ns => output += `    - ${ns.ldhName}\n`);
            }

            // Qeydiyyatçı məlumatı
            const registrar = data.entities ? data.entities.find(e => e.roles.includes('registrar')) : null;
            if (registrar && registrar.vcardArray) {
                const regName = registrar.vcardArray[1].find(v => v[0] === 'fn');
                if (regName) output += `[+] REGISTRAR: ${regName[3]}\n`;
            }

            content.innerHTML = output;
            loader.style.display = 'none';
            resBox.style.display = 'block';

        } catch (error) {
            // Əgər hər iki metod alınmazsa, birbaşa Whois-ə yönəlmiş sadə məlumat göstər
            console.error(error);
            content.innerHTML = `<span style="color:#ff3e3e">[!] Error: RDAP serveri bu domen üçün məlumat vermir.</span>\n\nBu domen (.az, .gov və s.) xüsusi qorumalı və ya RDAP dəstəkləməyən bir zonada ola bilər.`;
            loader.style.display = 'none';
            resBox.style.display = 'block';
        }
    }
</script>