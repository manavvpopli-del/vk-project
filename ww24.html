<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WW24 | Admin Control</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root { --red: #ff3e3e; --cyan: #00f2ff; --bg: #05070a; --glass: rgba(255,255,255,0.05); }
        body { background: var(--bg); color: white; font-family: 'Inter', sans-serif; margin: 0; padding: 20px; }
        
        .header { border-left: 5px solid var(--red); padding-left: 15px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; }
        
        .user-card { background: var(--glass); border: 1px solid #222; border-radius: 15px; padding: 20px; transition: 0.3s; position: relative; overflow: hidden; }
        .user-card:hover { border-color: var(--cyan); box-shadow: 0 0 20px rgba(0,242,255,0.1); }
        .user-card.frozen { border-color: #ffcc00; background: rgba(255, 204, 0, 0.05); }

        .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .online { background: #25d366; box-shadow: 0 0 10px #25d366; }

        input { background: #000; border: 1px solid #333; color: white; padding: 10px; border-radius: 8px; width: 100%; box-sizing: border-box; margin-bottom: 10px; font-size: 0.8rem; }
        
        .actions { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .btn { border: none; padding: 10px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 0.75rem; transition: 0.2s; text-transform: uppercase; }
        .btn-msg { background: var(--cyan); color: #000; grid-column: 1 / -1; }
        .btn-freeze { background: #ffcc00; color: #000; }
        .btn-kick { background: var(--red); color: #fff; }
        .btn-points { background: #fff; color: #000; grid-column: 1 / -1; }
        
        .btn:hover { opacity: 0.8; transform: scale(1.02); }
        .badge { font-size: 0.7rem; background: #222; padding: 3px 8px; border-radius: 5px; color: var(--cyan); }
    </style>
</head>
<body>

    <div class="header">
        <div>
            <h1 style="margin:0; letter-spacing: 2px;">WW24 COMMANDER <span style="font-size: 0.8rem; color: #666;">v2.0</span></h1>
            <p style="color: #666; margin: 5px 0 0 0;">Canlı müdaxilə və istifadəçi idarəetmə paneli</p>
        </div>
        <div id="global-stats" class="badge">Yüklənir...</div>
    </div>

    <div class="grid" id="admin-grid">
        </div>

    <script>
        const firebaseConfig = { 
            apiKey: "AIzaSyCM5WdZNSj9oFipNI-J3csHpOIvK8PjoLU", 
            databaseURL: "https://sevgili-testi-default-rtdb.firebaseio.com", 
            projectId: "sevgili-testi" 
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function renderAdmin() {
            db.ref('users').on('value', (snapshot) => {
                const grid = document.getElementById('admin-grid');
                grid.innerHTML = "";
                let count = 0;

                snapshot.forEach((child) => {
                    count++;
                    const user = child.val();
                    const name = child.key;
                    const isFrozen = user.status === 'frozen';

                    const card = document.createElement('div');
                    card.className = `user-card ${isFrozen ? 'frozen' : ''}`;
                    card.innerHTML = `
                        <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom:15px;">
                            <div>
                                <span class="status-dot online"></span>
                                <b style="font-size:1.1rem; color:${isFrozen ? '#ffcc00' : '#fff'}">${name.toUpperCase()}</b>
                            </div>
                            <span class="badge">${user.points || 0} PTS</span>
                        </div>

                        <input type="text" id="msg-${name}" placeholder="Canlı mesaj və ya bildiriş...">
                        
                        <div class="actions">
                            <button class="btn btn-msg" onclick="sendCmd('${name}', 'message')"><i class="fas fa-paper-plane"></i> Mesaj Göndər</button>
                            <button class="btn btn-freeze" onclick="sendCmd('${name}', '${isFrozen ? 'unfreeze' : 'freeze'}')">
                                <i class="fas fa-${isFrozen ? 'unlock' : 'snowflake'}"></i> ${isFrozen ? 'AÇ' : 'DONDUR'}
                            </button>
                            <button class="btn btn-kick" onclick="sendCmd('${name}', 'kick')"><i class="fas fa-door-open"></i> KICK</button>
                            <input type="number" id="pts-${name}" placeholder="Xal təyin et..." style="margin: 8px 0 0 0;">
                            <button class="btn btn-points" onclick="updatePoints('${name}')">XALI YENİLƏ</button>
                        </div>
                    `;
                    grid.appendChild(card);
                });
                document.getElementById('global-stats').innerText = `TOPLAM: ${count} İSTİFADƏÇİ`;
            });
        }

        function sendCmd(name, type) {
            const msgVal = document.getElementById(`msg-${name}`).value;
            const ref = db.ref(`commands/${name}`);
            
            let data = { type: type, time: Date.now() };
            if(type === 'message') {
                if(!msgVal) return alert("Mesaj daxil edin!");
                data.text = msgVal;
                document.getElementById(`msg-${name}`).value = "";
            }

            // Əgər dondurma əmridirsə, istifadəçinin statusunu da dəyiş
            if(type === 'freeze') db.ref(`users/${name}/status`).set('frozen');
            if(type === 'unfreeze') db.ref(`users/${name}/status`).set('active');

            ref.set(data).then(() => {
                console.log(`Command sent to ${name}: ${type}`);
            });
        }

        function updatePoints(name) {
            const newPts = document.getElementById(`pts-${name}`).value;
            if(!newPts) return;
            db.ref(`users/${name}/points`).set(parseInt(newPts)).then(() => {
                alert(`${name} üçün xal ${newPts} olaraq dəyişdirildi.`);
                document.getElementById(`pts-${name}`).value = "";
            });
        }

        renderAdmin();
    </script>
</body>
</html>